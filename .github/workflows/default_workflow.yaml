name: Default workflow
on: [push]

jobs:
  run_inserts_count_check:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.6.9'
      - name: install dependencies
        run: |
          pip install invoke gitpython
      - name: run inserts count check
        run: invoke tests.inserts-count-check

  run_commit_stage_in_container:
    runs-on: ubuntu-20.04
    container:
      image: tensorflow/tensorflow:2.2.0-gpu
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.6.9'
      - name: install dependencies
        run: |
          pip install pytest pycodestyle xenon pylint invoke
      - name: check directory content
        working-directory: /app
        run: echo $PWD && ls -la
      - name: run unit tests
        working-directory: /app
        run: invoke tests.unit-tests
      - name: run static code analysis
        working-directory: /app
        run: invoke tests.static-code-analysis
